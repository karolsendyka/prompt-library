--- 
import { supabaseClient } from "@/db/supabase.client";
import { PromptService } from "@/lib/services/prompt.service";
import Layout from "../layouts/Layout.astro";
import PromptList from "../components/prompts/PromptList.astro";
import { SearchInput } from "@/components/common/SearchInput";
import { SortControls } from "@/components/common/SortControls";
import { TagFilterInput } from "@/components/common/TagFilterInput";

const url = new URL(Astro.request.url);
const initialSearch = url.searchParams.get("search") || "";
const initialSortBy = (url.searchParams.get("sortBy") as any) || "created_at";
const initialOrder = (url.searchParams.get("order") as any) || "desc";
const initialTag = url.searchParams.get("tag") || "";

const promptService = new PromptService(supabaseClient);
const { data: prompts } = await promptService.listPrompts({
  search: initialSearch,
  sortBy: initialSortBy,
  order: initialOrder,
  tag: initialTag,
  limit: 20,
  offset: 0,
});
---

<Layout title="Prompt Library">
  <main class="container mx-auto p-4">
    <div class="flex flex-col sm:flex-row sm:flex-wrap justify-between items-center gap-4 mb-6">
      <SearchInput client:load initialSearch={initialSearch} className="flex-1 min-w-[250px]" />
      <div class="flex flex-col sm:flex-row gap-4">
        <SortControls client:load initialSortBy={initialSortBy} initialOrder={initialOrder} />
        <TagFilterInput client:load initialTag={initialTag} />
      </div>
    </div>
    <PromptList prompts={prompts} />
  </main>
</Layout>
